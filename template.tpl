___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Reddit Conversion API",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Tag that send the event data from the GA4/Data client to Reddit Conversion API.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "RADIO",
    "name": "eventType",
    "displayName": "Event Name Setup Method",
    "radioItems": [
      {
        "value": "standard",
        "displayValue": "Standard",
        "subParams": [
          {
            "type": "SELECT",
            "name": "eventName",
            "macrosInSelect": false,
            "selectItems": [
              {
                "value": "PageVisit",
                "displayValue": "PageVisit"
              },
              {
                "value": "ViewContent",
                "displayValue": "ViewContent"
              },
              {
                "value": "Search",
                "displayValue": "Search"
              },
              {
                "value": "AddToCart",
                "displayValue": "AddToCart"
              },
              {
                "value": "AddToWishlist",
                "displayValue": "AddToWishlist"
              },
              {
                "value": "Purchase",
                "displayValue": "Purchase"
              },
              {
                "value": "Lead",
                "displayValue": "Lead"
              },
              {
                "value": "SignUp",
                "displayValue": "SignUp"
              }
            ],
            "simpleValueType": true,
            "alwaysInSummary": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "displayName": "Event Name",
            "defaultValue": "PageVisit"
          }
        ]
      },
      {
        "value": "inherit",
        "subParams": [],
        "displayValue": "Inherit from client"
      },
      {
        "value": "custom",
        "subParams": [
          {
            "type": "TEXT",
            "name": "eventNameCustom",
            "displayName": "",
            "simpleValueType": true
          }
        ],
        "displayValue": "Custom"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "standard"
  },
  {
    "type": "TEXT",
    "name": "accountId",
    "displayName": "Account ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "The ID of the Reddit Ads account that the conversion event belongs to. Your account ID may or may not contain the \"t2_\" prefix."
  },
  {
    "type": "TEXT",
    "name": "accessToken",
    "displayName": "Conversion Access Token",
    "simpleValueType": true,
    "help": "A conversion access token is a non-expiring secure key that lets you send conversion event data. \u003ca href\u003d\"https://business.reddithelp.com/helpcenter/s/article/conversion-access-token\" target\u003d\"_blank\"\u003eLearn more\u003c/a\u003e",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "testId",
    "displayName": "Test ID",
    "simpleValueType": true,
    "help": "Test your events using the Reddit Event Testing Tool.\n\u003cbr/\u003e\nThis field can’t be used when the “Test Mode” option below is checked.",
    "enablingConditions": [
      {
        "paramName": "testMode",
        "paramValue": false,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "testMode",
    "checkboxText": "Test Mode",
    "simpleValueType": true,
    "help": "A flag indicating whether the events should be processed.\n\u003cbr/\u003e\nCheck this field when testing out the API integration and no data will be posted to the account.\n\u003cbr/\u003e\nWhen checked, it can’t be used together with the “Test ID” option above."
  },
  {
    "type": "CHECKBOX",
    "name": "useOptimisticScenario",
    "checkboxText": "Use Optimistic Scenario",
    "simpleValueType": true,
    "help": "The tag will call gtmOnSuccess() without waiting for a response from the API. This will speed up sGTM response time however your tag will always return the status fired successfully even in case it is not."
  },
  {
    "displayName": "Common Event Data Override",
    "name": "commonEventDataListGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "type": "TEXT",
        "name": "eventAt",
        "displayName": "Event At",
        "simpleValueType": true,
        "help": "The RFC3339 timestamp when the conversion event occurred."
      },
      {
        "type": "TEXT",
        "name": "clickId",
        "displayName": "Click ID",
        "simpleValueType": true,
        "help": "The Reddit-generated id associated with a single ad click."
      }
    ]
  },
  {
    "displayName": "Server Event Data Override",
    "name": "serverEventDataListGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "name": "serverEventDataList",
        "simpleTableColumns": [
          {
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "defaultValue": "value",
            "displayName": "Property Name",
            "name": "name",
            "isUnique": true,
            "type": "SELECT",
            "selectItems": [
              {
                "value": "conversion_id",
                "displayValue": "Conversion ID"
              },
              {
                "value": "currency",
                "displayValue": "Currency"
              },
              {
                "value": "item_count",
                "displayValue": "Item Count"
              },
              {
                "value": "products",
                "displayValue": "Products"
              },
              {
                "value": "value",
                "displayValue": "Value (Integer – Transaction amount in the smallest currency unit, e.g., cents, centavos, paise.)"
              },
              {
                "value": "value_decimal",
                "displayValue": "Value Decimal (Float – Transaction amount in the main currency unit, e.g., dollars, euros, pesos.)"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Property Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add property"
      }
    ]
  },
  {
    "displayName": "User Data",
    "name": "userDataListGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "name": "userDataList",
        "simpleTableColumns": [
          {
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "defaultValue": "email",
            "displayName": "Property Name",
            "name": "name",
            "isUnique": true,
            "type": "SELECT",
            "selectItems": [
              {
                "value": "ip_address",
                "displayValue": "IP address"
              },
              {
                "value": "email",
                "displayValue": "Email"
              },
              {
                "value": "external_id",
                "displayValue": "External ID"
              },
              {
                "value": "idfa",
                "displayValue": "idfa"
              },
              {
                "value": "aaid",
                "displayValue": "aaid"
              },
              {
                "value": "opt_out",
                "displayValue": "Opt Out"
              },
              {
                "value": "user_agent",
                "displayValue": "User Agent"
              },
              {
                "value": "screen_dimensions",
                "displayValue": "Screen Dimensions"
              },
              {
                "value": "uuid",
                "displayValue": "UUID"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Property Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add property"
      }
    ]
  },
  {
    "displayName": "Logs Settings",
    "name": "logsGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "type": "RADIO",
        "name": "logType",
        "radioItems": [
          {
            "value": "no",
            "displayValue": "Do not log"
          },
          {
            "value": "debug",
            "displayValue": "Log to console during debug and preview"
          },
          {
            "value": "always",
            "displayValue": "Always log to console"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "debug"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const getAllEventData = require('getAllEventData');
const JSON = require('JSON');
const sendHttpRequest = require('sendHttpRequest');
const setCookie = require('setCookie');
const getCookieValues = require('getCookieValues');
const getContainerVersion = require('getContainerVersion');
const logToConsole = require('logToConsole');
const getRequestHeader = require('getRequestHeader');
const parseUrl = require('parseUrl');
const decodeUriComponent = require('decodeUriComponent');
const getType = require('getType');
const getTimestampMillis = require('getTimestampMillis');
const makeNumber = require('makeNumber');
const makeString = require('makeString');
const makeInteger = require('makeInteger');
const encodeUriComponent = require('encodeUriComponent');

/**********************************************************************************************/

const isLoggingEnabled = determinateIsLoggingEnabled();
const traceId = isLoggingEnabled ? getRequestHeader('trace-id') : undefined;

const eventData = getAllEventData();

const url = eventData.page_location || getRequestHeader('referer');

const deprecatedCookie = getCookieValues('rdt_cid')[0];
if (deprecatedCookie) {
  setCookie('rdt_cid', '', {
    domain: 'auto',
    path: '/',
    samesite: 'Lax',
    secure: true,
    'max-age': 0,
    httpOnly: false
  });
}
let rdtcid = deprecatedCookie || getCookieValues('_rdt_cid')[0] || eventData.rdt_cid;

if (url) {
  const urlParsed = parseUrl(url);

  if (urlParsed && urlParsed.searchParams.rdt_cid) {
    rdtcid = decodeUriComponent(urlParsed.searchParams.rdt_cid);
  }
}

if (rdtcid) {
  setCookie('_rdt_cid', rdtcid, {
    domain: 'auto',
    path: '/',
    samesite: 'Lax',
    secure: true,
    'max-age': 2592000, // 30 days
    httpOnly: false
  });
}

const apiVersion = '2.0';
const postUrl = 'https://ads-api.reddit.com/api/v' + apiVersion + '/conversions/events/' + enc(data.accountId);

const eventType = getEventType(eventData, data);
const eventName = eventType.tracking_type === 'Custom' ? eventType.custom_event_name : eventType.tracking_type;
const postBody = mapEvent(eventData, data);

if (isLoggingEnabled) {
  logToConsole(
    JSON.stringify({
      Name: 'Reddit',
      Type: 'Request',
      TraceId: traceId,
      EventName: eventName,
      RequestMethod: 'POST',
      RequestUrl: postUrl,
      RequestBody: postBody
    })
  );
}

sendHttpRequest(
  postUrl,
  (statusCode, headers, body) => {
    if (isLoggingEnabled) {
      logToConsole(
        JSON.stringify({
          Name: 'Reddit',
          Type: 'Response',
          TraceId: traceId,
          EventName: eventName,
          ResponseStatusCode: statusCode,
          ResponseHeaders: headers,
          ResponseBody: body
        })
      );
    }
    if (!data.useOptimisticScenario) {
      if (statusCode >= 200 && statusCode < 400) {
        data.gtmOnSuccess();
      } else {
        data.gtmOnFailure();
      }
    }
  },
  {
    headers: {
      'Content-Type': 'application/json',
      Authorization: 'Bearer ' + data.accessToken
    },
    method: 'POST'
  },
  JSON.stringify(postBody)
);

if (data.useOptimisticScenario) {
  data.gtmOnSuccess();
}

/**********************************************************************************************/
// Vendor related functions

function mapEvent(eventData, data) {
  let mappedData = {
    event_type: eventType
  };

  if (data.eventAt) {
    mappedData.event_at = data.eventAt;
  } else {
    mappedData.event_at_ms = getTimestampMillis();
  }

  if (data.clickId) {
    mappedData.click_id = data.clickId;
  } else if (rdtcid) {
    mappedData.click_id = rdtcid;
  }

  mappedData = addUserData(eventData, mappedData);
  mappedData = addPropertiesData(eventData, mappedData);

  return {
    events: [mappedData],
    test_mode: data.testMode,
    test_id: data.testId
  };
}

function addPropertiesData(eventData, mappedData) {
  mappedData.event_metadata = {};

  if (eventData.event_id) mappedData.event_metadata.conversion_id = makeString(eventData.event_id);
  else if (eventData.transaction_id) mappedData.event_metadata.conversion_id = makeString(eventData.transaction_id);

  if (eventData.currency) mappedData.event_metadata.currency = eventData.currency;
  if (eventData.item_count) mappedData.event_metadata.item_count = eventData.item_count;

  if (isValidValue(eventData.value)) mappedData.event_metadata.value_decimal = makeNumber(eventData.value);
  else if (isValidValue(eventData['x-ga-mp1-ev'])) mappedData.event_metadata.value_decimal = makeNumber(eventData['x-ga-mp1-ev']);
  else if (isValidValue(eventData['x-ga-mp1-tr'])) mappedData.event_metadata.value_decimal = makeNumber(eventData['x-ga-mp1-tr']);

  if (eventData.products) mappedData.event_metadata.products = eventData.products;
  else if (eventData.items && eventData.items[0]) {
    mappedData.event_metadata.products = [];

    eventData.items.forEach((d, i) => {
      let item = {};

      if (d.item_id) item.id = makeString(d.item_id);
      else if (d.id) item.id = makeString(d.id);

      if (d.content_category) item.category = d.content_category;
      else if (d.category) item.category = d.category;

      if (d.content_name) item.name = d.content_name;
      else if (d.name) item.name = d.name;

      mappedData.event_metadata.products.push(item);
    });
  }

  if (data.serverEventDataList) {
    data.serverEventDataList.forEach((d) => {
      let value = d.value;
      switch (d.name) {
        case 'value_decimal':
          value = makeNumber(value);
          break;
        case 'value':
          value = makeInteger(value);
          break;
      }
      mappedData.event_metadata[d.name] = value;
    });
  }

  return mappedData;
}

function addUserData(eventData, mappedData) {
  let userEventData = {};
  mappedData.user = {};

  if (getType(eventData.user_data) === 'object') {
    userEventData = eventData.user_data || eventData.user_properties || eventData.user;
  }
  const uuid = getUUIDFromCookie() || eventData.rdt_uuid;
  if (uuid) mappedData.user.uuid = uuid;
  if (eventData.aaid) mappedData.user.aaid = eventData.aaid;
  else if (userEventData.aaid) mappedData.user.aaid = userEventData.aaid;

  if (eventData.email) mappedData.user.email = eventData.email;
  else if (eventData.email_address) mappedData.user.email = eventData.email_address;
  else if (userEventData.email) mappedData.user.email = userEventData.email;
  else if (userEventData.email_address) mappedData.user.email = userEventData.email_address;
  else if (getCookieValues('_rdt_em')[0]) mappedData.user.email = getCookieValues('_rdt_em')[0];

  if (eventData.external_id) mappedData.user.external_id = eventData.external_id;
  else if (eventData.user_id) mappedData.user.external_id = eventData.user_id;
  else if (eventData.userId) mappedData.user.external_id = eventData.userId;
  else if (userEventData.external_id) mappedData.user.external_id = userEventData.external_id;

  if (eventData.idfa) mappedData.user.idfa = eventData.idfa;
  else if (userEventData.idfa) mappedData.user.idfa = userEventData.idfa;

  if (eventData.ip_override) mappedData.user.ip_address = eventData.ip_override;
  else if (eventData.ip_address) mappedData.user.ip_address = eventData.ip_address;
  else if (eventData.ip) mappedData.user.ip_address = eventData.ip;

  if (eventData.opt_out) mappedData.user.opt_out = eventData.opt_out;
  if (eventData.user_agent) mappedData.user.user_agent = eventData.user_agent;

  if (eventData.viewport_size && eventData.viewport_size.split('x').length === 2) {
    mappedData.user.screen_dimensions = {
      width: makeInteger(eventData.viewport_size.split('x')[0]),
      height: makeInteger(eventData.viewport_size.split('x')[1])
    };
  } else if (eventData.height && eventData.width) {
    mappedData.user.screen_dimensions = {
      height: makeInteger(eventData.height),
      width: makeInteger(eventData.width)
    };
  }

  if (data.userDataList) {
    data.userDataList.forEach((d) => {
      mappedData.user[d.name] = d.value;
    });
  }

  return mappedData;
}

function getUUIDFromCookie() {
  const uuidsWithTimestamps = getCookieValues('_rdt_uuid');
  if (!uuidsWithTimestamps || !uuidsWithTimestamps.length) return null;
  let oldest = null;
  for (let i = 0; i < uuidsWithTimestamps.length; i++) {
    const current = getUUIDAndTimestamp(uuidsWithTimestamps[i]);
    if (!current) continue;
    if (!oldest || current.timestamp < oldest.timestamp) oldest = current;
  }
  return oldest && oldest.uuid;
}

function getUUIDAndTimestamp(uuidWithTimestamp) {
  if (!uuidWithTimestamp) return null;
  const parts = uuidWithTimestamp.split('.');
  if (parts.length !== 2) return null;

  return {
    timestamp: makeNumber(parts[0]),
    uuid: makeString(parts[1])
  };
}

function getEventType(eventData, data) {
  if (data.eventType === 'inherit') {
    let eventName = eventData.event_name;

    let gaToEventName = {
      page_view: 'PageVisit',
      click: 'Lead',
      download: 'Lead',
      file_download: 'Lead',
      complete_registration: 'SignUp',
      'gtm.dom': 'PageVisit',
      add_payment_info: 'Lead',
      add_to_cart: 'AddToCart',
      add_to_wishlist: 'AddToWishlist',
      sign_up: 'SignUp',
      begin_checkout: 'Lead',
      generate_lead: 'Lead',
      purchase: 'Purchase',
      search: 'Search',
      view_item: 'ViewContent',

      contact: 'Lead',
      find_location: 'Search',
      submit_application: 'Lead',
      subscribe: 'Lead',

      'gtm4wp.addProductToCartEEC': 'AddToCart',
      'gtm4wp.productClickEEC': 'ViewContent',
      'gtm4wp.checkoutOptionEEC': 'Lead',
      'gtm4wp.checkoutStepEEC': 'Lead',
      'gtm4wp.orderCompletedEEC': 'Purchase'
    };

    if (!gaToEventName[eventName]) {
      return {
        tracking_type: 'Custom',
        custom_event_name: eventName
      };
    }

    return {
      tracking_type: gaToEventName[eventName]
    };
  }
  if (data.eventNameCustom == 'Purchase' || data.eventNameCustom == 'SignUp') {
    return {
      tracking_type: data.eventNameCustom
    };
  }

  if (data.eventType === 'custom') {
    return {
      tracking_type: 'Custom',
      custom_event_name: data.eventNameCustom
    };
  }

  return {
    tracking_type: data.eventName
  };
}

/**********************************************************************************************/
// Helpers

function enc(data) {
  return encodeUriComponent(data || '');
}

function isValidValue(value) {
  const valueType = getType(value);
  return valueType !== 'null' && valueType !== 'undefined' && value !== '';
}

function determinateIsLoggingEnabled() {
  const containerVersion = getContainerVersion();
  const isDebug = !!(containerVersion && (containerVersion.debugMode || containerVersion.previewMode));

  if (!data.logType) {
    return isDebug;
  }

  if (data.logType === 'no') {
    return false;
  }

  if (data.logType === 'debug') {
    return isDebug;
  }

  return data.logType === 'always';
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "headerWhitelist",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "trace-id"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "referer"
                  }
                ]
              }
            ]
          }
        },
        {
          "key": "headersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "rdt_cid"
              },
              {
                "type": 1,
                "string": "_rdt_cid"
              },
              {
                "type": 1,
                "string": "_rdt_uuid"
              },
              {
                "type": 1,
                "string": "_rdt_em"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "rdt_cid"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_rdt_cid"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://ads-api.reddit.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: value is correctly cast into Integer when retrieved from UI
  code: "const expectedEventAt = 1746467516146;\nmockData.eventAt = expectedEventAt;\n\
    mockData.eventType = 'standard';\nconst expectedEventName = 'PageVisit';\nmockData.eventName\
    \ = expectedEventName;\n\nconst valueInputValue = '123';\nconst expectedValue\
    \ = 123;\nmockData.serverEventDataList = [{ name: 'value', value: valueInputValue\
    \ }];\n\nconst expectedRequestUrl = 'https://ads-api.reddit.com/api/v2.0/conversions/events/'\
    \ + expectedAccountId;\nconst expectedRequestOptions = {\n  headers: {\n    'Content-Type':\
    \ 'application/json',\n    Authorization: 'Bearer ' + expectedAccessToken\n  },\n\
    \  method: 'POST'\n};\n\nmock('sendHttpRequest', (requestUrl, callback, requestOptions,\
    \ requestBody) => {\n  const requestBodyParsed = JSON.parse(requestBody);\n  assertThat(requestUrl).isEqualTo(expectedRequestUrl);\n\
    \  assertThat(callback).isFunction();\n  assertThat(requestOptions).isEqualTo(expectedRequestOptions);\n\
    \  assertThat(requestBodyParsed).isEqualTo({\n    events: [\n      {\n       \
    \ event_type: { tracking_type: expectedEventName },\n        event_at: expectedEventAt,\n\
    \        user: {},\n        event_metadata: { value: expectedValue }\n      }\n\
    \    ]\n  });\n  \n  callback(200);\n});\n\nrunCode(mockData);\n\nassertApi('gtmOnSuccess').wasCalled();\n\
    assertApi('gtmOnFailure').wasNotCalled();\nassertApi('makeInteger').wasCalledWith(valueInputValue);\n"
- name: value_decimal is correctly cast into Number when retrieved from UI
  code: "const expectedEventAt = 1746467516146;\nmockData.eventAt = expectedEventAt;\n\
    mockData.eventType = 'standard';\nconst expectedEventName = 'PageVisit';\nmockData.eventName\
    \ = expectedEventName;\n\nconst valueDecimalInputValue = '123.99';\nconst expectedValueDecimal\
    \ = 123.99;\nmockData.serverEventDataList = [{ name: 'value_decimal', value: valueDecimalInputValue\
    \ }];\n\nconst expectedRequestUrl = 'https://ads-api.reddit.com/api/v2.0/conversions/events/'\
    \ + expectedAccountId;\nconst expectedRequestOptions = {\n  headers: {\n    'Content-Type':\
    \ 'application/json',\n    Authorization: 'Bearer ' + expectedAccessToken\n  },\n\
    \  method: 'POST'\n};\n\nmock('sendHttpRequest', (requestUrl, callback, requestOptions,\
    \ requestBody) => {\n  const requestBodyParsed = JSON.parse(requestBody);\n  assertThat(requestUrl).isEqualTo(expectedRequestUrl);\n\
    \  assertThat(callback).isFunction();\n  assertThat(requestOptions).isEqualTo(expectedRequestOptions);\n\
    \  assertThat(requestBodyParsed).isEqualTo({\n    events: [\n      {\n       \
    \ event_type: { tracking_type: expectedEventName },\n        event_at: expectedEventAt,\n\
    \        user: {},\n        event_metadata: { value_decimal: expectedValueDecimal\
    \ }\n      }\n    ]\n  });\n  \n  callback(200);\n});\n\nrunCode(mockData);\n\n\
    assertApi('gtmOnSuccess').wasCalled();\nassertApi('gtmOnFailure').wasNotCalled();\n\
    assertApi('makeNumber').wasCalledWith(valueDecimalInputValue);\n"
- name: value_decimal is correctly cast into Number when retrieved from Event Data
  code: "const expectedEventAt = 1746467516146;\nmockData.eventAt = expectedEventAt;\n\
    mockData.eventType = 'standard';\nconst expectedEventName = 'PageVisit';\nmockData.eventName\
    \ = expectedEventName;\n\nconst expectedValueDecimal = 123.99;\nmock('getAllEventData',\
    \ {\n  value: expectedValueDecimal\n});\n\nconst expectedRequestUrl = 'https://ads-api.reddit.com/api/v2.0/conversions/events/'\
    \ + expectedAccountId;\nconst expectedRequestOptions = {\n  headers: {\n    'Content-Type':\
    \ 'application/json',\n    Authorization: 'Bearer ' + expectedAccessToken\n  },\n\
    \  method: 'POST'\n};\n\nmock('sendHttpRequest', (requestUrl, callback, requestOptions,\
    \ requestBody) => {\n  const requestBodyParsed = JSON.parse(requestBody);\n  assertThat(requestUrl).isEqualTo(expectedRequestUrl);\n\
    \  assertThat(callback).isFunction();\n  assertThat(requestOptions).isEqualTo(expectedRequestOptions);\n\
    \  assertThat(requestBodyParsed).isEqualTo({\n    events: [\n      {\n       \
    \ event_type: { tracking_type: expectedEventName },\n        event_at: expectedEventAt,\n\
    \        user: {},\n        event_metadata: { value_decimal: expectedValueDecimal\
    \ }\n      }\n    ]\n  });\n  \n  callback(200);\n});\n\nrunCode(mockData);\n\n\
    assertApi('gtmOnSuccess').wasCalled();\nassertApi('gtmOnFailure').wasNotCalled();\n\
    assertApi('makeNumber').wasCalledWith(expectedValueDecimal);\n"
- name: Click ID cookie is successfully retrieved from deprecated cookie and sent
    in the request payload
  code: "const expectedEventAt = 1746467516146;\nmockData.eventAt = expectedEventAt;\n\
    mockData.eventType = 'standard';\nconst expectedEventName = 'PageVisit';\nmockData.eventName\
    \ = expectedEventName;\n\nconst expectedRequestUrl = 'https://ads-api.reddit.com/api/v2.0/conversions/events/'\
    \ + expectedAccountId;\nconst expectedRequestOptions = {\n  headers: {\n    'Content-Type':\
    \ 'application/json',\n    Authorization: 'Bearer ' + expectedAccessToken\n  },\n\
    \  method: 'POST'\n};\n  \nconst expectedClickId = 'expectedClickIdDeprecatedCookie';\n\
    mock('getCookieValues', (cookieName) => {\n  if (cookieName === 'rdt_cid') return\
    \ [expectedClickId];\n  return [];\n});\n\nmock('sendHttpRequest', (requestUrl,\
    \ callback, requestOptions, requestBody) => {\n  const requestBodyParsed = JSON.parse(requestBody);\n\
    \  assertThat(requestUrl).isEqualTo(expectedRequestUrl);\n  assertThat(callback).isFunction();\n\
    \  assertThat(requestOptions).isEqualTo(expectedRequestOptions);\n  assertThat(requestBodyParsed).isEqualTo({\n\
    \    events: [\n      {\n        event_type: { tracking_type: expectedEventName\
    \ },\n        event_at: expectedEventAt,\n        click_id: expectedClickId,\n\
    \        user: {},\n        event_metadata: {}\n      }\n    ]\n  });\n  \n  callback(200);\n\
    });\n\nrunCode(mockData);\n\nassertApi('gtmOnSuccess').wasCalled();\nassertApi('gtmOnFailure').wasNotCalled();"
- name: Click ID cookie is successfully retrieved from new cookie and sent in the
    request payload
  code: "const expectedEventAt = 1746467516146;\nmockData.eventAt = expectedEventAt;\n\
    mockData.eventType = 'standard';\nconst expectedEventName = 'PageVisit';\nmockData.eventName\
    \ = expectedEventName;\n\nconst expectedRequestUrl = 'https://ads-api.reddit.com/api/v2.0/conversions/events/'\
    \ + expectedAccountId;\nconst expectedRequestOptions = {\n  headers: {\n    'Content-Type':\
    \ 'application/json',\n    Authorization: 'Bearer ' + expectedAccessToken\n  },\n\
    \  method: 'POST'\n};\n\n\nconst expectedClickId = 'expectedClickIdNewCookie';\n\
    mock('getCookieValues', (cookieName) => {\n  if (cookieName === '_rdt_cid') return\
    \ [expectedClickId];\n  return [];\n});\n\nmock('sendHttpRequest', (requestUrl,\
    \ callback, requestOptions, requestBody) => {\n  const requestBodyParsed = JSON.parse(requestBody);\n\
    \  assertThat(requestUrl).isEqualTo(expectedRequestUrl);\n  assertThat(callback).isFunction();\n\
    \  assertThat(requestOptions).isEqualTo(expectedRequestOptions);\n  assertThat(requestBodyParsed).isEqualTo({\n\
    \    events: [\n      {\n        event_type: { tracking_type: expectedEventName\
    \ },\n        event_at: expectedEventAt,\n        click_id: expectedClickId,\n\
    \        user: {},\n        event_metadata: {}\n      }\n    ]\n  });\n  \n  callback(200);\n\
    });\n\nrunCode(mockData);\n\nassertApi('gtmOnSuccess').wasCalled();\nassertApi('gtmOnFailure').wasNotCalled();"
- name: Click ID cookie is successfully retrieved from Event Data and sent in the
    request payload
  code: "const expectedEventAt = 1746467516146;\nmockData.eventAt = expectedEventAt;\n\
    mockData.eventType = 'standard';\nconst expectedEventName = 'PageVisit';\nmockData.eventName\
    \ = expectedEventName;\n\nconst expectedRequestUrl = 'https://ads-api.reddit.com/api/v2.0/conversions/events/'\
    \ + expectedAccountId;\nconst expectedRequestOptions = {\n  headers: {\n    'Content-Type':\
    \ 'application/json',\n    Authorization: 'Bearer ' + expectedAccessToken\n  },\n\
    \  method: 'POST'\n};\n\nconst expectedClickId = 'expectedClickIdEventData';\n\
    mock('getAllEventData',{\n  rdt_cid: expectedClickId\n});\n\nmock('sendHttpRequest',\
    \ (requestUrl, callback, requestOptions, requestBody) => {\n  const requestBodyParsed\
    \ = JSON.parse(requestBody);\n  assertThat(requestUrl).isEqualTo(expectedRequestUrl);\n\
    \  assertThat(callback).isFunction();\n  assertThat(requestOptions).isEqualTo(expectedRequestOptions);\n\
    \  assertThat(requestBodyParsed).isEqualTo({\n    events: [\n      {\n       \
    \ event_type: { tracking_type: expectedEventName },\n        event_at: expectedEventAt,\n\
    \        click_id: expectedClickId,\n        user: {},\n        event_metadata:\
    \ {}\n      }\n    ]\n  });\n  \n  callback(200);\n});\n\nrunCode(mockData);\n\
    \nassertApi('gtmOnSuccess').wasCalled();\nassertApi('gtmOnFailure').wasNotCalled();"
- name: Click ID cookie is successfully retrieved from URL parameter and sent in the
    request payload
  code: "const expectedEventAt = 1746467516146;\nmockData.eventAt = expectedEventAt;\n\
    mockData.eventType = 'standard';\nconst expectedEventName = 'PageVisit';\nmockData.eventName\
    \ = expectedEventName;\n\nconst expectedRequestUrl = 'https://ads-api.reddit.com/api/v2.0/conversions/events/'\
    \ + expectedAccountId;\nconst expectedRequestOptions = {\n  headers: {\n    'Content-Type':\
    \ 'application/json',\n    Authorization: 'Bearer ' + expectedAccessToken\n  },\n\
    \  method: 'POST'\n};\n\nconst expectedClickId = 'expectedClickIdEventData';\n\
    mock('getAllEventData',{\n  page_location: 'https://example.com/?rdt_cid=' + expectedClickId\n\
    });\n\nmock('sendHttpRequest', (requestUrl, callback, requestOptions, requestBody)\
    \ => {\n  const requestBodyParsed = JSON.parse(requestBody);\n  assertThat(requestUrl).isEqualTo(expectedRequestUrl);\n\
    \  assertThat(callback).isFunction();\n  assertThat(requestOptions).isEqualTo(expectedRequestOptions);\n\
    \  assertThat(requestBodyParsed).isEqualTo({\n    events: [\n      {\n       \
    \ event_type: { tracking_type: expectedEventName },\n        event_at: expectedEventAt,\n\
    \        click_id: expectedClickId,\n        user: {},\n        event_metadata:\
    \ {}\n      }\n    ]\n  });\n  \n  callback(200);\n});\n\nrunCode(mockData);\n\
    \nassertApi('gtmOnSuccess').wasCalled();\nassertApi('gtmOnFailure').wasNotCalled();"
- name: Click ID cookie is successfully retrieved from Data and sent in the request
    payload
  code: "const expectedEventAt = 1746467516146;\nmockData.eventAt = expectedEventAt;\n\
    mockData.eventType = 'standard';\nconst expectedEventName = 'PageVisit';\nmockData.eventName\
    \ = expectedEventName;\n\nconst expectedRequestUrl = 'https://ads-api.reddit.com/api/v2.0/conversions/events/'\
    \ + expectedAccountId;\nconst expectedRequestOptions = {\n  headers: {\n    'Content-Type':\
    \ 'application/json',\n    Authorization: 'Bearer ' + expectedAccessToken\n  },\n\
    \  method: 'POST'\n};\n\nconst expectedClickId = 'expectedClickIdData';\nmockData.clickId\
    \ = expectedClickId;\n\nmock('sendHttpRequest', (requestUrl, callback, requestOptions,\
    \ requestBody) => {\n  const requestBodyParsed = JSON.parse(requestBody);\n  assertThat(requestUrl).isEqualTo(expectedRequestUrl);\n\
    \  assertThat(callback).isFunction();\n  assertThat(requestOptions).isEqualTo(expectedRequestOptions);\n\
    \  assertThat(requestBodyParsed).isEqualTo({\n    events: [\n      {\n       \
    \ event_type: { tracking_type: expectedEventName },\n        event_at: expectedEventAt,\n\
    \        click_id: expectedClickId,\n        user: {},\n        event_metadata:\
    \ {}\n      }\n    ]\n  });\n  \n  callback(200);\n});\n\nrunCode(mockData);\n\
    \nassertApi('gtmOnSuccess').wasCalled();\nassertApi('gtmOnFailure').wasNotCalled();"
- name: Screen Dimensions are successfully retrieved from Event Data screen_dimensions
    and cast to integer
  code: "const expectedEventAt = 1746467516146;\nmockData.eventAt = expectedEventAt;\n\
    mockData.eventType = 'standard';\nconst expectedEventName = 'PageVisit';\nmockData.eventName\
    \ = expectedEventName;\n\nconst expectedRequestUrl = 'https://ads-api.reddit.com/api/v2.0/conversions/events/'\
    \ + expectedAccountId;\nconst expectedRequestOptions = {\n  headers: {\n    'Content-Type':\
    \ 'application/json',\n    Authorization: 'Bearer ' + expectedAccessToken\n  },\n\
    \  method: 'POST'\n};\n\nconst expectedScreenDimensions = { width: 111, height:\
    \ 222 };\nmock('getAllEventData', {\n  viewport_size: expectedScreenDimensions.width\
    \ + 'x' + expectedScreenDimensions.height\n});\n\n\nmock('sendHttpRequest', (requestUrl,\
    \ callback, requestOptions, requestBody) => {\n  const requestBodyParsed = JSON.parse(requestBody);\n\
    \  assertThat(requestUrl).isEqualTo(expectedRequestUrl);\n  assertThat(callback).isFunction();\n\
    \  assertThat(requestOptions).isEqualTo(expectedRequestOptions);\n  assertThat(requestBodyParsed).isEqualTo({\n\
    \    events: [\n      {\n        event_type: { tracking_type: expectedEventName\
    \ },\n        event_at: expectedEventAt,\n        user: {\n          screen_dimensions:\
    \ { width: expectedScreenDimensions.width, height: expectedScreenDimensions.height\
    \ }          \n        },\n        event_metadata: {}\n      }\n    ]\n  });\n\
    \  \n  callback(200);\n});\n\nrunCode(mockData);\n\nassertApi('gtmOnSuccess').wasCalled();\n\
    assertApi('gtmOnFailure').wasNotCalled();"
- name: Screen Dimensions are successfully retrieved from Event Data width/height
    and cast to integer
  code: "const expectedEventAt = 1746467516146;\nmockData.eventAt = expectedEventAt;\n\
    mockData.eventType = 'standard';\nconst expectedEventName = 'PageVisit';\nmockData.eventName\
    \ = expectedEventName;\n\nconst expectedRequestUrl = 'https://ads-api.reddit.com/api/v2.0/conversions/events/'\
    \ + expectedAccountId;\nconst expectedRequestOptions = {\n  headers: {\n    'Content-Type':\
    \ 'application/json',\n    Authorization: 'Bearer ' + expectedAccessToken\n  },\n\
    \  method: 'POST'\n};\n\nconst expectedScreenDimensions = { width: 111, height:\
    \ 222 };\nmock('getAllEventData', {\n  width: expectedScreenDimensions.width,\n\
    \  height: expectedScreenDimensions.height\n});\n\nmock('sendHttpRequest', (requestUrl,\
    \ callback, requestOptions, requestBody) => {\n  const requestBodyParsed = JSON.parse(requestBody);\n\
    \  assertThat(requestUrl).isEqualTo(expectedRequestUrl);\n  assertThat(callback).isFunction();\n\
    \  assertThat(requestOptions).isEqualTo(expectedRequestOptions);\n  assertThat(requestBodyParsed).isEqualTo({\n\
    \    events: [\n      {\n        event_type: { tracking_type: expectedEventName\
    \ },\n        event_at: expectedEventAt,\n        user: {\n          screen_dimensions:\
    \ { width: expectedScreenDimensions.width, height: expectedScreenDimensions.height\
    \ }          \n        },\n        event_metadata: {}\n      }\n    ]\n  });\n\
    \  \n  callback(200);\n});\n\nrunCode(mockData);\n\nassertApi('gtmOnSuccess').wasCalled();\n\
    assertApi('gtmOnFailure').wasNotCalled();"
setup: |-
  const JSON = require('JSON');

  const expectedAccountId = 'expectedAccountId';
  const expectedAccessToken = 'expectedAccessToken';

  const mockData = {
    accountId: expectedAccountId,
    accessToken: expectedAccessToken
  };


___NOTES___

Created on 28/07/2023, 16:50:17

